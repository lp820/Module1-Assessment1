                                                            /* Codes for Creating Tables */

/* For creating and populating the hospitals table */

CREATE TABLE hospitals
(hospital_id INT unsigned NOT NULL,
name VARCHAR(150) NOT NULL,
address VARCHAR(150) NOT NULL,
size INT NOT NULL,
type VARCHAR(150) NOT NULL,
accreditation_status VARCHAR(150) NOT NULL,
PRIMARY KEY (hospital_id)
);
 
LOAD DATA LOCAL INFILE "~/Module1-Assessment1/hospitals.csv" INTO TABLE hospitals 
FIELDS TERMINATED BY ',' 
OPTIONALLY ENCLOSED BY '"'
IGNORE 1 LINES 
(hospital_id, name, address, size, type, accreditation_status);


/* For creating and populating the doctors table */
 
CREATE TABLE doctors
(person_id INT unsigned NOT NULL,
name VARCHAR(150) NOT NULL,
date_of_birth DATE NOT NULL,
address VARCHAR(150) NOT NULL,
role VARCHAR(150) NOT NULL,
hospital_id INT unsigned NOT NULL,
PRIMARY KEY (person_id)
);
 
LOAD DATA LOCAL INFILE "~/Module1-Assessment1/doctors.csv" INTO TABLE doctors
FIELDS TERMINATED BY ',' 
OPTIONALLY ENCLOSED BY '"'
IGNORE 1 LINES 
(person_id, name, date_of_birth, address, role, hospital_id);


/ *For creating and populating the patients table */
 
CREATE TABLE patients
(person_id INT unsigned NOT NULL,
name VARCHAR(150) NOT NULL,
date_of_birth DATE NOT NULL,
address VARCHAR(150) NOT NULL,
role VARCHAR(150) NOT NULL,
doctor_id INT unsigned NOT NULL,
PRIMARY KEY (person_id)
);

LOAD DATA LOCAL INFILE "~/Module1-Assessment1/patients.csv" INTO TABLE patients
FIELDS TERMINATED BY ',' 
OPTIONALLY ENCLOSED BY '"'
IGNORE 1 LINES 
(person_id, name, date_of_birth, address, role, doctor_id);


/* For creating and populating the prescriptions table */
 
CREATE TABLE prescriptions
(prescription_id INT unsigned NOT NULL,
patient_id INT unsigned NOT NULL,
doctor_id INT unsigned NOT NULL,
medication VARCHAR(150) NOT NULL,
prescription_date DATE NOT NULL
);
 
LOAD DATA LOCAL INFILE "~/Module1-Assessment1/prescriptions.csv" INTO TABLE prescriptions
FIELDS TERMINATED BY ',' 
OPTIONALLY ENCLOSED BY '"'
IGNORE 1 LINES 
(prescription_id, patient_id, doctor_id, medication, prescription_date);



                                                            /* Codes for Establishing Relationships Between Tables */
/* To link doctors table with hospitals table*/ 

ALTER TABLE doctors
ADD CONSTRAINT fk_doctors_hospitals
FOREIGN KEY (hospital_id)
REFERENCES hospitals(hospital_id);


/* To link patients table with doctors table */

ALTER TABLE patients
ADD CONSTRAINT fk_patients_doctors
FOREIGN KEY (doctor_id)
REFERENCES doctors(person_id);


/* To link prescriptions table with doctors table */

ALTER TABLE prescriptions
ADD CONSTRAINT fk_prescriptions_doctors
FOREIGN KEY (doctor_id)
REFERENCES doctors(person_id);


/* To link prescriptions table with patients table */

ALTER TABLE prescriptions
ADD CONSTRAINT fk_prescriptions_patients
FOREIGN KEY (patient_id)
REFERENCES patients(personal_id);


                                                              /* MySQL Queries */
/* QUERY1: List of All Doctors at a Given Hospital */

SELECT doctors.* , hospitals.name, hospitals.hospital_id
FROM doctors 
LEFT JOIN hospitals
ON doctors.hospital_id = hospitals.hospital_id
WHERE doctors.hospital_id = ?;



/* QUERY2: All Prescriptions for a Patient, Ordered by Prescription Date */

SELECT prescriptions.*, patients.person_id, patients.name, patients.date_of_birth, patients.doctor_id
FROM prescriptions
LEFT JOIN patients
ON prescriptions.patient_id = patients.person_id
WHERE prescriptions.patient_id = ?
ORDER BY prescription_date;



/* QUERY3: All Prescriptions By Specified Doctor */

SELECT prescriptions.*, doctors.person_id, doctors.name, doctors.hospital_id 
FROM prescriptions 
LEFT JOIN doctors
ON prescriptions.doctor_id = doctors.person_id
WHERE prescriptions.doctor_id = ?;


/* QUERY4: Add New Patient Registered with a Doctor */

INSERT INTO patients (person_id, name, date_of_birth, address, role, doctor_id) 
VALUES (?, ?, ?, ?, ?, ?);



/*QUERY5 ERRORING DRAFT*/
SELECT doctor_id, COUNT(*)
FROM prescriptions
GROUP BY doctor_id
LEFT JOIN doctors
ON prescriptions.doctor_id = doctors.person_id
ORDER BY COUNT(*) DESC; 



/* QUERY6: All Doctors in the Hospital with Largest Capacity */

SELECT doctors.*, hospitals.name, hospitals.size
FROM hospitals
LEFT JOIN doctors
ON hospitals.hospital_id = doctors.hospital_id
WHERE size = (SELECT MAX(size) FROM hospitals);



